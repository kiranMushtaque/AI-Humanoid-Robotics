
# Chapter 7: Robot Navigation with Nav2

## Learning Objectives

- Understand the components of the Nav2 stack.
- Learn how to configure and launch Nav2 for a simulated robot.
- Perform mapping, localization, and path planning.

:::tip[Simple Explanation: Robot GPS and Self-Driving]

How does a robot know where it is and how to get to where it's going? That's what **Nav2** (the ROS 2 Navigation Stack) is for. Think of it as a complete GPS and self-driving system for your robot.

-   **Mapping is like Drawing the Map:** Before you can navigate a building, you need a map. A process called **SLAM** (Simultaneous Localization and Mapping) is like walking through the building and drawing a map of all the walls and obstacles as you go.

-   **Localization is "You Are Here":** Once you have the map, **AMCL** is the part that looks at what the robot's sensors see right now and figures out its exact position on the map. It's the "You Are Here" pin on your GPS.

-   **Path Planning is Plotting the Course:** When you give the robot a goal (like "go to the kitchen"), the **Planner** looks at the map and calculates the best long-distance route to get there, avoiding all the walls.

-   **The Controller is the Driver:** The **Controller** is like the driver. It follows the planned route but also pays attention to things that might have appeared suddenly, like a person walking by. It makes small adjustments to the robot's speed and direction to avoid these immediate obstacles while still following the overall path.

Nav2 combines all these jobs to let a robot move around on its own, safely and efficiently.

:::

## The Nav2 Stack

Nav2 is the second generation of the ROS Navigation Stack. It is a powerful and flexible system for autonomous robot navigation. The main components include:

-   **Map Server:** Provides a map of the environment.
-   **AMCL (Adaptive Monte Carlo Localization):** Estimates the robot's position on the map.
-   **Behavior Tree (BT) Navigator:** A flexible system for orchestrating navigation tasks.
-   **Planner:** Generates a global path from the robot's current position to a goal.
-   **Controller:** Generates velocity commands to follow the global path while avoiding local obstacles.

## Configuring Nav2

Configuring Nav2 involves creating a set of YAML files to define the parameters for each component.

-   `nav2_params.yaml`: Contains the main configuration for the planners, controllers, and other components.
-   `map.yaml`: The map file generated by the mapping process.

You will also need a launch file to bring up all the Nav2 nodes.

```python title="nav2_bringup_launch.py (simplified)"
from launch import LaunchDescription
from launch_ros.actions import Node
from nav2_common.launch import RewrittenYaml

def generate_launch_description():
    # ...
    params_file = 'path/to/your/nav2_params.yaml'

    return LaunchDescription([
        Node(
            package='nav2_controller',
            executable='controller_server',
            parameters=[params_file]),
        Node(
            package='nav2_planner',
            executable='planner_server',
            parameters=[params_file]),
        # ... other Nav2 nodes
    ])
```

## Running Navigation

1.  **Mapping:** Use a SLAM (Simultaneous Localization and Mapping) algorithm like `slam_toolbox` to create a map of the environment.
    ```bash
    ros2 launch slam_toolbox online_async_launch.py
    ```
2.  **Localization:** Once you have a map, use AMCL to localize the robot within it.
    ```bash
    ros2 launch nav2_bringup localization_launch.py map:=/path/to/your/map.yaml
    ```
3.  **Path Planning:** In RViz2, you can use the "2D Pose Estimate" tool to set the initial pose and the "Nav2 Goal" tool to send a goal to the robot.

## Exercises

1.  Use the `slam_toolbox` package to create a map of a Gazebo world.
2.  Configure Nav2 to use your generated map.
3.  Send a navigation goal to your robot and watch it navigate autonomously.

## Beginner Exercises

1.  The process of creating a map while figuring out the robot's location is called <span className="exercise-blank">SLAM</span>.
2.  The Nav2 component that figures out the robot's current position on a pre-made map is <span className="exercise-blank">AMCL</span>.
3.  The component that plans the long-distance route to a goal is the <span className="exercise-blank">Planner</span>.
4.  The component that acts as the "driver," avoiding local obstacles, is the <span className="exercise-blank">Controller</span>.
